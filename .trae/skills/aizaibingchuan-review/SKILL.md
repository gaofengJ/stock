---
name: "aizaibingchuan-review"
description: "生成爱在冰川复盘文档。当用户输入 '/aizaibingchuan-review'、'爱在冰川复盘' 或提供日期链接时触发此技能。"
---

# 爱在冰川复盘生成器

## 描述

此技能用于根据提供的链接和日期，自动抓取内容并按照模板生成“爱在冰川”的复盘文档。它集成了网页内容抓取、Markdown 格式清洗、文件生成以及索引更新的全流程自动化。

## 使用场景

当用户有以下需求时触发此技能：

- 输入 `/aizaibingchuan-review`
- 输入 `生成爱在冰川复盘`
- 提供日期和公众号文章链接，并表达生成复盘的意图

## 指令

1. **获取内容**：
   - 使用 `WebFetch` 工具抓取用户提供的链接内容。
   - 如果抓取失败，提示用户手动提供内容。

2. **内容清洗与优化**：
   - **角色设定**：你是一位精通 Markdown 格式转换与内容提炼的助手。
   - **严格清洗规则**：
     - **删除**：所有图片占位符、图片说明、广告卡片及“点击查看图片”等无效信息。
     - **段落优化**：**务必保留原文的换行与分段结构**。原文中的每一行通常代表一个独立的语义单元或短句，**严禁**将其合并为大段落。请保留原文的视觉节奏，使文档保持“诗歌般”的短句分行风格，避免出现密集的大段文字。
     - **易读性处理**：确保段落或短句之间有适当的空行（Markdown标准段落间距），以提升阅读体验。
     - **保持原意**：严禁修改、改写或润色原文文字，仅做格式上的分段优化。
     - **保留标记**：保留原文中的加粗、引用、列表等 Markdown 格式。

3. **内容校验**：
   - **语法检查**：检查生成的 Markdown 内容中是否存在未闭合的代码块（如奇数个 ``` 或 ~~~）。
   - **异常符号修复**：检查是否存在异常的长符号串（如 `~~~~~~~~`），如果它们不是作为代码块的分隔符，**必须直接移除**。特别是当符号串后紧跟文字时（如 `~~~~~~~~祝好`），必须将符号串部分删除，确保不出现解析报错。
   - **引用检查**：确保所有图片和链接的引用格式正确，无悬空的 `]` 或 `)`。

4. **生成文件内容**：
   - 读取模板文件：`templates/review-template.md`。
   - 按照以下规则填充模板中的占位符：
     - `[YYYY-M-D格式日期]`：替换为实际日期（格式如 `2024-1-1`，注意月和日不补零）。
     - `[YYYYMMDD格式日期]`：替换为排序用日期（格式如 `20240101`，用于 `order` 字段）。
     - `[在此处放入提供的链接]`：替换为原文链接。
     - `[此处粘贴清洗并优化空行后的文章全文]`：替换为经过第 2 步清洗和第 3 步校验后的正文内容。

5. **创建文件**：
   - 确定年份目录：`[YYYY]`。
   - 确定文件名：`[YYYY-M-D].md`（例如 `2024-1-1.md`）。
   - 目标路径：`f:\code\stock\apps\blog\docs\src\reviews\aizaibingchuan\[YYYY]\[YYYY-M-D].md`。
   - 检查年份目录是否存在，若不存在则创建。
   - 将填充好的完整内容写入新文件。

6. **更新索引**：
   - 读取 `f:\code\stock\apps\blog\docs\src\reviews\aizaibingchuan\index.md`。
   - 检查新文件是否已列出。
   - 如果未列出，则按格式 `- [[日期]复盘](./[YYYY]/[文件名])` 添加新条目（例如 `- [2024-1-1复盘](./2024/2024-1-1.md)`）。
   - 如果需要，对索引进行排序（或根据现有顺序添加到末尾/开头）。

7. **配置更新**：
   - 执行脚本 `node f:\code\stock\apps\blog\scripts\generate-config.js` 以重新生成侧边栏和导航配置，确保新文件能在网站中即时显示。

8. **最终验证**：
   - 向用户确认文件已创建、索引已更新且配置脚本已执行。

## 示例

**输入**：
> /aizaibingchuan-review 2024-02-20 <https://mp.weixin.qq.com/s/example>

**输出**：
> 已成功获取链接内容并生成复盘文档：`f:\code\stock\apps\blog\docs\src\reviews\aizaibingchuan\2024\2024-2-20.md`
> 同时也更新了索引文件。
